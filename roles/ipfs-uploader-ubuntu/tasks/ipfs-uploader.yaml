- name: Getting ipfs-uploader from github
  git:
    repo: 'https://github.com/dtube/ipfs-uploader.git'
    dest: /home/heimindanger/ipfs-uploader
    update: no

- name: Changeing permissions on ipfs-uploader directory making it heimindanger:dtube 0770
  file:
    path: /home/heimindanger/ipfs-uploader/
    owner: heimindanger
    group: dtube
    mode: 0770
    recurse: yes

- name: Ensuring we can build by removing NuGetScratch
  file:
    path: /tmp/NuGetScratch/
    state: absent

- name: Compiling uploader.dll
  command: dotnet publish -c release
  args:
    creates: /home/heimindanger/ipfs-uploader/bin/release/netcoreapp2.0/Uploader.dll
    chdir: /home/heimindanger/ipfs-uploader
  become_user: heimindanger


- name: Starting upldr tmux session as heimindanger (may fail when session already exists)
  command: tmux new -d -s upldr
  become: true
  become_user: heimindanger
  ignore_errors: yes

- name: Starting ipfs-uploader in afforementioned tmux session as heimindanger
  command: tmux send -t upldr.0 "dotnet /home/heimindanger/ipfs-uploader/bin/release/netcoreapp2.0/Uploader.dll" ENTER
  become: true
  become_user: heimindanger
